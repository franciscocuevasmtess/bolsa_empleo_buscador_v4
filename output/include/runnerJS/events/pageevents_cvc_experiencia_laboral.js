
Runner.pages.PageSettings.addPageEvent('bolsa_empleo.cvc_experiencia_laboral',Runner.pages.constants.PAGE_ADD,"afterPageReady",function(pageObj,proxy,pageid,inlineRow,inlineObject,row){var ctrl_fecha_desde=Runner.getControl(pageid,'fecha_inicio');var ctrl_fecha_hasta=Runner.getControl(pageid,'fecha_fin');var csstotal=Runner.getControl(pageid,'anhos_de_experiencia');var ctrl_meses_experiencia=Runner.getControl(pageid,'meses_de_experiencia');var ctrl_empresa=Runner.getControl(pageid,'empresa');var ctrl_puesto=Runner.getControl(pageid,'fk_puesto_ocupacion');var ctrl_habilidades=Runner.getControl(pageid,'fk_habilidades');var ctrltitulo=Runner.getControl(pageid,'descripcion_puesto');var ctrl_categoria=Runner.getControl(pageid,'fk_categoria_id');csstotal.makeReadonly();ctrl_fecha_hasta.on('change',function(){var diff=Number(ctrl_fecha_hasta.getValue())-Number(ctrl_fecha_desde.getValue());csstotal.setValue(diff.toFixed(0));});ctrltitulo.addStyle('text-transform: uppercase;');$(".value_fk_puesto_ocupacion_"+pageid).select2({tags:false,placeholder:'Seleccionar',allowClear:true,multiple:false,language:"es",ajax:{url:"select2_cvc_puesto_ocupacion_streaming.php",dataType:"json",delay:250,data:function(params){return{page:params.page||1,term:params.term};},processResults:function(data,params){return{results:data.results,pagination:{more:data.pagination.more}};},cache:true},minimumInputLength:0});ctrl_categoria.on('change',function(){if(ctrl_categoria.getValue()=='1'){ctrl_empresa.setValue("SIN DATOS");$(".value_fk_habilidades_"+pageid).val("171").trigger("change");$(".value_fk_puesto_ocupacion_"+pageid).select2("trigger","select",{data:{id:"10000018",text:"SIN DATOS"}});ctrl_fecha_desde.setValue(0);ctrl_fecha_hasta.setValue(0);csstotal.setValue(0);ctrl_meses_experiencia.setValue(0);ctrltitulo.setValue("SIN DATOS");}else{ctrl_empresa.clear();$(".value_fk_habilidades_"+pageid).val([]).trigger("change");$(".value_fk_puesto_ocupacion_"+pageid).val([]).trigger("change");ctrl_fecha_desde.clear();ctrl_fecha_hasta.clear();csstotal.clear();ctrl_meses_experiencia.clear();ctrltitulo.clear();}});$(".value_fk_habilidades_"+pageid).select2({tags:true,placeholder:'Tu Habilidades relevantes',allowClear:true,multiple:true,language:"es",ajax:{url:"streaming_habilidades.php",dataType:"json",delay:250,data:function(params){return{page:params.page||1,term:params.term};},processResults:function(data,params){return{results:data.results,pagination:{more:data.pagination.more}};},cache:true},minimumInputLength:0,createTag:function(params){var term=$.trim(params.term);if(term==='')return null;console.log("Nuevo tag detectado:",term);return{id:'new:'+term,text:term,newTag:true};}});$(".value_fk_habilidades_"+pageid).on('select2:select',function(e){var data=e.params.data;if(data.newTag){$.ajax({url:"streaming_habilidades.php",type:"POST",data:{new_habilidad:data.text},success:function(response){var jsonResponse=JSON.parse(response);if(jsonResponse.success){var $select=$(".value_fk_habilidades_"+pageid);var $option=$select.find("option").filter(function(){return $(this).text()===data.text;});if($option.length>0){$option.val(jsonResponse.id);}else{var newOption=new Option(jsonResponse.text,jsonResponse.id,true,true);$select.append(newOption);}
$select.trigger('change');}else{alert("Error al guardar la nueva habilidad.");}}});}});this.on('beforeSave',function(formObj,fieldControlsArr,pageObj){var valores2=$(".value_fk_habilidades_"+pageid).val();var strr2=valores2.toString();formObj.baseParams['valores_multi_habilidades_conocimiento_todos']=strr2;console.log($(".value_fk_habilidades_"+pageid).select2("val"));});;});Runner.pages.PageSettings.addPageEvent('bolsa_empleo.cvc_experiencia_laboral',Runner.pages.constants.PAGE_EDIT,"afterPageReady",function(pageObj,proxy,pageid,inlineRow,inlineObject,row){var ctrl_fecha_desde=Runner.getControl(pageid,'fecha_inicio');var ctrl_fecha_hasta=Runner.getControl(pageid,'fecha_fin');var csstotal=Runner.getControl(pageid,'anhos_de_experiencia');var ctrl_meses_experiencia=Runner.getControl(pageid,'meses_de_experiencia');var ctrl_empresa=Runner.getControl(pageid,'empresa');var ctrl_puesto=Runner.getControl(pageid,'fk_puesto_ocupacion');ctrl_puesto.addStyle('text-transform: uppercase;');csstotal.makeReadonly();ctrl_fecha_hasta.on('change',function(){var diff=Number(ctrl_fecha_hasta.getValue())-Number(ctrl_fecha_desde.getValue());csstotal.setValue(diff.toFixed(0));});var ctrltitulo=Runner.getControl(pageid,'descripcion_puesto');ctrltitulo.addStyle('text-transform: uppercase;');var ctrlproveedor=Runner.getControl(pageid,'proveedor');if(ctrlproveedor.getValue()=='REOP'||ctrlproveedor.getValue()=='IPS')
{ctrl_fecha_desde.makeReadonly();ctrl_fecha_hasta.makeReadonly();ctrl_meses_experiencia.makeReadonly();ctrl_empresa.makeReadonly();}
$(".value_fk_habilidades_"+pageid).select2({tags:true,placeholder:'Tus Habilidades relevantes',allowClear:true,multiple:true,language:"es",ajax:{url:"streaming_habilidades.php",dataType:"json",delay:250,data:function(params){return{page:params.page||1,term:params.term};},processResults:function(data,params){return{results:data.results,pagination:{more:data.pagination.more}};},cache:true},minimumInputLength:0,createTag:function(params){var term=$.trim(params.term);if(term==='')return null;console.log("Nuevo tag detectado:",term);return{id:'new:'+term,text:term,newTag:true};}});$(".value_fk_habilidades_"+pageid).on('select2:select',function(e){var data=e.params.data;if(data.newTag){$.ajax({url:"streaming_habilidades.php",type:"POST",data:{new_habilidad:data.text},success:function(response){var jsonResponse=JSON.parse(response);if(jsonResponse.success){var $select=$(".value_fk_habilidades_"+pageid);var $option=$select.find("option").filter(function(){return $(this).text()===data.text;});if($option.length>0){$option.val(jsonResponse.id);}else{var newOption=new Option(jsonResponse.text,jsonResponse.id,true,true);$select.append(newOption);}
$select.trigger('change');}else{alert("Error al guardar la nueva habilidad.");}}});}});this.on('beforeSave',function(formObj,fieldControlsArr,pageObj){var valores2=$(".value_fk_habilidades_"+pageid).val();var strr2=valores2.toString();formObj.baseParams['valores_multi_habilidades_conocimiento_todos']=strr2;console.log($(".value_fk_habilidades_"+pageid).select2("val"));});;});